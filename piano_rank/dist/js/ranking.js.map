{"version":3,"sources":["ranking.js"],"names":["RankingItem","ranking","avatar","name","sex","score","this","media","prototype","makeHTML","rankingItemDIV","document","createElement","className","innerHTML","$","ready","window","localStorage","sessionId","API","getUserInfo","data","code","result","attr","avater","show","html","nickname","addClass","gender","record","insistDay","infoData","getSign","wx","config","debug","appId","timestamp","nonceStr","signature","jsApiList","onMenuShareTimeline","title","desc","link","imgUrl","success","res","cancel","onMenuShareAppMessage","err","console","log","getAllRecordsRank","list","forEach","item","index","rankingItem","before","getAllDaysRank","click","removeClass"],"mappings":"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","file":"ranking.js","sourcesContent":["// $(document).ready(function () {\r\n\r\n//     $('#btnCheck').click(function (e) {\r\n\r\n//         wx.onMenuShareAppMessage({\r\n//             title: '123',\r\n//             desc: '123',\r\n//             // link: 'http://www.ppfix.cn/activity/piano_rank/index.html',\r\n//             // imgUrl: 'http://www.ppfix.cn/activity/piano_rank/imgs/logo.png',\r\n//             link: window.location.href,\r\n//             imgUrl: 'http://demo.open.weixin.qq.com/jssdk/images/p2166127561.jpg',\r\n//             trigger: function (res) {\r\n//                 // 不要尝试在trigger中使用ajax异步请求修改本次分享的内容，因为客户端分享操作是一个同步操作，这时候使用ajax的回包会还没有返回\r\n//                 alert('用户点击发送给朋友');\r\n//             },\r\n//             success: function (res) {\r\n//                 alert('已分享');\r\n//             },\r\n//             cancel: function (res) {\r\n//                 alert('已取消');\r\n//             },\r\n//             fail: function (res) {\r\n//                 alert(JSON.stringify(res));\r\n//             }\r\n//         });\r\n\r\n//     })\r\n\r\n// });\r\n\r\nfunction RankingItem(ranking, avatar, name, sex, score) {\r\n    this.ranking = ranking;\r\n    this.media = ranking == 1 ? 'icon-gold' : (ranking == 2 ? 'icon-silver' : (ranking == 3 ? 'icon-copper' : 'icon-medal'));\r\n    this.avatar = avatar || 'imgs/avatar.png';\r\n    this.name = name || '-';\r\n    this.sex = sex == 2 ? 'icon-female' : (sex == 1 ? 'icon-male' : '');\r\n    this.score = score || 0;\r\n}\r\n\r\nRankingItem.prototype.makeHTML = function () {\r\n\r\n    var rankingItemDIV = document.createElement('div');\r\n    rankingItemDIV.className = 'item';\r\n\r\n    rankingItemDIV.innerHTML = '\\\r\n        <div class=\"left\">\\\r\n            <span class=\"medal icon ' + this.media + '\">' + (this.ranking > 3 ? this.ranking : '') + '</span>\\\r\n            <img class=\"avatar\" src=\"' + this.avatar + '\" alt=\"avatar\">\\\r\n            <span class=\"name\">' + this.name + '</span>\\\r\n            <span class=\"sex icon ' + this.sex + '\"></span>\\\r\n        </div>\\\r\n        <div class=\"right\">' + this.score + '</div>';\r\n\r\n    return rankingItemDIV;\r\n\r\n}\r\n\r\n// 校验计时器状态\r\n// $(document).ready(function () {\r\n\r\n//     if (window.localStorage.sessionId && window.localStorage.timerFlag == 'true') {\r\n\r\n//         var hours = parseInt(window.localStorage.hours || 0);\r\n//         var minutes = parseInt(window.localStorage.minutes || 0);\r\n//         var seconds = parseInt(window.localStorage.seconds || 0);\r\n\r\n//         setInterval(function () {\r\n\r\n//             seconds++;\r\n\r\n//             if (seconds >= 60) {\r\n//                 seconds = 0;\r\n//                 minutes++;\r\n//             }\r\n\r\n//             if (minutes >= 60) {\r\n//                 minutes = 0;\r\n//                 hours++;\r\n//             }\r\n\r\n//             if (hours >= 24) {\r\n//                 hours = 0;\r\n//             }\r\n\r\n//             window.localStorage.hours = hours;\r\n//             window.localStorage.minutes = minutes;\r\n//             window.localStorage.seconds = seconds;\r\n\r\n//         }, 1000);\r\n\r\n//     }\r\n\r\n\r\n// });\r\n\r\n\r\n\r\n\r\n\r\n// 初始化信息\r\n$(document).ready(function () {\r\n\r\n    if (!window.localStorage.sessionId) {\r\n        return;\r\n    }\r\n\r\n    // var nickname = '-';\r\n    // var sex = 0;\r\n    // var avatar = window.location.host + '/imgs/avatar.png';\r\n    // var insistDay = 0;\r\n    // var record = 0;\r\n    // var allRecords = 0\r\n\r\n    API.getUserInfo(\r\n        window.localStorage.sessionId,\r\n        function (data) {\r\n\r\n            if (data.code != 'SUCCESS' || !data.result) {\r\n                return;\r\n            }\r\n\r\n            $('#avatar').attr('src', data.result.avater || 'imgs/avatar.png');\r\n            $('#avatar').show();\r\n            $('#name').html(data.result.nickname);\r\n            $('#sex').addClass(data.result.gender == 1 ? 'icon-male' : (data.result.gender == 2 ? 'icon-female' : ''));\r\n            $('#practiceTime').html(data.result.record);\r\n            $('#duration').html(data.result.insistDay);\r\n\r\n            // nickname = data.result.nickname;\r\n            // insistDay = data.result.insistDay;\r\n            // sex = data.result.gender;\r\n            // avatar = data.result.avater;\r\n            // allRecords = data.result.record;\r\n\r\n            var infoData = data.result;\r\n\r\n            API.getSign(\r\n\r\n                function (data) {\r\n\r\n                    if (!data.code == 'SUCCESS' || !data.result) {\r\n                        return;\r\n                    }\r\n\r\n                    var result = data.result;\r\n\r\n                    wx.config({\r\n                        debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。\r\n                        appId: result.appId, // 必填，公众号的唯一标识\r\n                        timestamp: result.timestamp, // 必填，生成签名的时间戳\r\n                        nonceStr: result.nonceStr, // 必填，生成签名的随机串\r\n                        signature: result.signature, // 必填，签名，见附录1\r\n                        jsApiList: [\r\n                            'onMenuShareAppMessage',\r\n                            'onMenuShareTimeline',\r\n                            // 'onMenuShareQQ',\r\n                            // 'onMenuShareWeibo',\r\n                            // 'onMenuShareQZone'\r\n                        ] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2\r\n                    });\r\n\r\n                    wx.onMenuShareTimeline({\r\n                        title: '晓雯音乐广州市桥分校百日练琴第三季活动',\r\n                        desc: infoData.nickname + '小朋友在晓雯音乐百日练琴计划中坚持了' + infoData.insistDay + '天，累计练习了' + infoData.record + '分钟',\r\n                        link: 'http://www.ppfix.cn/activity/piano_rank/share.html?n=' + infoData.nickname + '&a=' + infoData.avater + '&s=' + infoData.gender + '&ar=' + infoData.record + '&i=' + infoData.insistDay,\r\n                        imgUrl: infoData.avater,\r\n                        success: function (res) {\r\n                            // alert('已分享');\r\n                        },\r\n                        cancel: function (res) {\r\n                            // alert('已取消');\r\n                        }\r\n                    });\r\n\r\n                    wx.onMenuShareAppMessage({\r\n                        title: '晓雯音乐广州市桥分校百日练琴第三季活动',\r\n                        desc: infoData.nickname + '小朋友在晓雯音乐百日练琴计划中坚持了' + infoData.insistDay + '天，累计练习了' + infoData.record + '分钟',\r\n                        link: 'http://www.ppfix.cn/activity/piano_rank/share.html?n=' + infoData.nickname + '&a=' + infoData.avater + '&s=' + infoData.gender + '&ar=' + infoData.record + '&i=' + infoData.insistDay,\r\n                        imgUrl: infoData.avater,\r\n                        success: function (res) {\r\n                            // alert('已分享');\r\n                        },\r\n                        cancel: function (res) {\r\n                            // alert('已取消');\r\n                        }\r\n                    });\r\n\r\n\r\n                },\r\n                function (err) {\r\n                    console.log(err);\r\n                },\r\n                function (data) {\r\n\r\n                }\r\n            );\r\n\r\n\r\n        },\r\n        function (err) {\r\n\r\n        },\r\n        function (data) {\r\n\r\n        }\r\n    );\r\n\r\n    // API.getDayRecords(\r\n    //     window.localStorage.sessionId,\r\n    //     function (data) {\r\n\r\n    //         if (data.code != 'SUCCESS' || !data.result) {\r\n    //             return;\r\n    //         }\r\n\r\n    //         var t = 0;\r\n\r\n    //         data.result.forEach(function (item, index) {\r\n\r\n    //             t += item.record;\r\n\r\n    //         });\r\n\r\n    //         record = t;\r\n\r\n    //     },\r\n    //     function (err) {\r\n\r\n    //     },\r\n    //     function (data) {\r\n\r\n    //     }\r\n    // );\r\n\r\n    API.getAllRecordsRank(\r\n        function (data) {\r\n\r\n            if (data.code != 'SUCCESS' || !data.result || !data.result.list) {\r\n                return;\r\n            }\r\n\r\n            data.result.list.forEach(function (item, index) {\r\n\r\n                var rankingItem = new RankingItem(index + 1, item.avater, item.nickname, item.gender, item.record);\r\n\r\n                $('#timeRanking .tips').before(rankingItem.makeHTML());\r\n            });\r\n\r\n\r\n        },\r\n        function (err) {\r\n\r\n        },\r\n        function (data) {\r\n\r\n        }\r\n\r\n    );\r\n\r\n    API.getAllDaysRank(\r\n        function (data) {\r\n\r\n            if (data.code != 'SUCCESS' || !data.result || !data.result.list) {\r\n                return;\r\n            }\r\n\r\n            data.result.list.forEach(function (item, index) {\r\n\r\n                var rankingItem = new RankingItem(index + 1, item.avater, item.nickname, item.gender, item.insistDay);\r\n\r\n                $('#dayRanking .tips').before(rankingItem.makeHTML());\r\n            });\r\n\r\n\r\n        },\r\n        function (err) {\r\n\r\n        },\r\n        function (data) {\r\n\r\n        }\r\n\r\n    );\r\n\r\n\r\n    // setTimeout(function () {\r\n\r\n    //     wx.onMenuShareAppMessage({\r\n    //         title: nickname + '小朋友在晓雯音乐百日练琴计划中坚持了' + insistDay + '天，今天练琴' + record + '分钟。',\r\n    //         desc: '',\r\n    //         link: window.location.host + 'share.html?n=' + nickname + '&a=' + avatar + '&s=' + sex + '&ar=' + allRecords + '&i=' + insistDay,\r\n    //         imgUrl: avatar,\r\n    //         trigger: function (res) {\r\n    //             // 不要尝试在trigger中使用ajax异步请求修改本次分享的内容，因为客户端分享操作是一个同步操作，这时候使用ajax的回包会还没有返回\r\n    //             alert('用户点击发送给朋友');\r\n    //         },\r\n    //         success: function (res) {\r\n    //             alert('已分享');\r\n    //         },\r\n    //         cancel: function (res) {\r\n    //             alert('已取消');\r\n    //         },\r\n    //         fail: function (res) {\r\n    //             alert(JSON.stringify(res));\r\n    //         }\r\n    //     });\r\n\r\n    //     wx.onMenuShareTimeline({\r\n    //         title: nickname + '小朋友在晓雯音乐百日练琴计划中坚持了' + insistDay + '天，今天练琴' + record + '分钟。',\r\n    //         desc: '',\r\n    //         link: window.location.host + 'share.html?n=' + nickname + '&a=' + avatar + '&s=' + sex + '&ar=' + allRecords + '&i=' + insistDay,\r\n    //         imgUrl: avatar,\r\n    //         trigger: function (res) {\r\n    //             // 不要尝试在trigger中使用ajax异步请求修改本次分享的内容，因为客户端分享操作是一个同步操作，这时候使用ajax的回包会还没有返回\r\n    //             alert('用户点击发送给朋友');\r\n    //         },\r\n    //         success: function (res) {\r\n    //             alert('已分享');\r\n    //         },\r\n    //         cancel: function (res) {\r\n    //             alert('已取消');\r\n    //         },\r\n    //         fail: function (res) {\r\n    //             alert(JSON.stringify(res));\r\n    //         }\r\n    //     });\r\n\r\n    // }, 3000);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n});\r\n\r\n// 初始化排行榜navbar\r\n$(document).ready(function () {\r\n\r\n\r\n    $('#showTimeRanking').click(function () {\r\n\r\n        $(this).addClass('active');\r\n        $('#showDayRanking').removeClass('active');\r\n\r\n        $('#timeRanking').removeClass('hide');\r\n        $('#dayRanking').addClass('hide');\r\n\r\n\r\n    });\r\n\r\n    $('#showDayRanking').click(function () {\r\n\r\n        $(this).addClass('active');\r\n        $('#showTimeRanking').removeClass('active');\r\n\r\n        $('#dayRanking').removeClass('hide');\r\n        $('#timeRanking').addClass('hide');\r\n    });\r\n\r\n});\r\n\r\n// 初始化数据\r\n// $(document).ready(function () {\r\n\r\n//     var items = [{\r\n//             media: 1,\r\n//             avatar: '',\r\n//             name: 'Pwcong',\r\n//             sex: 1,\r\n//             score: 100\r\n//         },\r\n//         {\r\n//             media: 2,\r\n//             avatar: '',\r\n//             name: 'Pwcong',\r\n//             sex: 0,\r\n//             score: 80\r\n//         },\r\n//         {\r\n//             media: 3,\r\n//             avatar: '',\r\n//             name: 'Pwcong',\r\n//             sex: 2,\r\n//             score: 60\r\n//         },\r\n//         {\r\n//             media: 4,\r\n//             avatar: '',\r\n//             name: 'Pwcong',\r\n//             sex: 1,\r\n//             score: 40\r\n//         }\r\n//     ];\r\n\r\n//     items.forEach(function (item, index) {\r\n\r\n//         var rankingItem = new RankingItem(item.media, item.avatar, item.name, item.sex, item.score);\r\n\r\n\r\n//         $('#timeRanking .tips').before(rankingItem.makeHTML());\r\n\r\n//         $('#dayRanking .tips').before(rankingItem.makeHTML());\r\n\r\n//     });\r\n\r\n// });"]}