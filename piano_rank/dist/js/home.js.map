{"version":3,"sources":["home.js"],"names":["uploadRecord","sessionId","record","startTime","endTime","API","data","code","weui","alert","message","className","toast","$","html","err","document","ready","window","localStorage","getUserInfo","result","attr","avater","removeClass","nickname","addClass","gender","click","picker","consts","TIME_PICKER_ITEM_HOUR","label","value","TIME_PICKER_ITEM_MINUTE","container","defaultValue","onChange","onConfirm","res","timerFlag","myTimer","MyTimer","t","parseInt","Date","parse","utils","formatTime","confirm","console","log","sessionStorage","start","this","stop","restart"],"mappings":"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","file":"home.js","sourcesContent":["// $(document).ready(function () {\r\n\r\n\r\n//     $('#btnSwitchManual').click(function () {\r\n\r\n//         $('#timer').addClass('hide');\r\n//         $('#manual').removeClass('hide');\r\n\r\n//     });\r\n\r\n//     $('#btnSwitchTimer').click(function () {\r\n\r\n//         $('#manual').addClass('hide');\r\n//         $('#timer').removeClass('hide');\r\n\r\n//     });\r\n\r\n// });\r\n\r\nfunction uploadRecord(sessionId, record, startTime, endTime) {\r\n\r\n    API.uploadRecord(\r\n        sessionId,\r\n        record,\r\n        startTime,\r\n        endTime,\r\n        function (data) {\r\n\r\n            if (data.code != 'SUCCESS') {\r\n                weui.alert(data.message, {\r\n                    className: 'dialog'\r\n                });\r\n            } else {\r\n\r\n                weui.toast('记录上传成功', 1500);\r\n                $('#lastRecord').html(record);\r\n\r\n            }\r\n        },\r\n        function (err) {\r\n\r\n            weui.alert('记录上传失败', {\r\n                className: 'dialog'\r\n            });\r\n        },\r\n        function (data) {\r\n\r\n        }\r\n\r\n    )\r\n\r\n}\r\n\r\n// 初始化信息\r\n$(document).ready(function () {\r\n\r\n    if (!window.localStorage.sessionId) {\r\n        return;\r\n    }\r\n\r\n    API.getUserInfo(\r\n        window.localStorage.sessionId,\r\n        function (data) {\r\n\r\n            if (data.code != 'SUCCESS' || !data.result) {\r\n                return;\r\n            }\r\n\r\n            $('#avatar').attr('src', data.result.avater || 'imgs/avatar.png');\r\n            $('#avatar').removeClass('hide');\r\n            $('#name').html(data.result.nickname);\r\n            $('#sex').addClass(data.result.gender == 1 ? 'icon-male' : (data.result.gender == 2 ? 'icon-female' : ''));\r\n\r\n        },\r\n        function (err) {\r\n\r\n        },\r\n        function (data) {\r\n\r\n        }\r\n    );\r\n\r\n\r\n});\r\n\r\n\r\n// 手动输入计时\r\n$(document).ready(function () {\r\n\r\n    $('#btnSwitchManual').click(function () {\r\n\r\n        weui.picker(\r\n            consts.TIME_PICKER_ITEM_HOUR, [{\r\n                label: '时',\r\n                value: '-'\r\n            }],\r\n            consts.TIME_PICKER_ITEM_MINUTE, [{\r\n                label: '分',\r\n                value: '-'\r\n            }], {\r\n                className: 'picker',\r\n                container: 'body',\r\n                defaultValue: [0, 0, 0],\r\n                onChange: function (result) {\r\n                    // console.log(result)\r\n                },\r\n                onConfirm: function (result) {\r\n\r\n                    var res = result[0].value * 60 + result[2].value;\r\n\r\n                    if (res < 1 || !window.localStorage.sessionId) {\r\n                        return;\r\n                    }\r\n\r\n                    uploadRecord(window.localStorage.sessionId, res);\r\n\r\n                },\r\n            });\r\n    });\r\n});\r\n\r\n\r\n// 计时器逻辑\r\n$(document).ready(function () {\r\n\r\n    var timerFlag = false;\r\n\r\n    var myTimer = new MyTimer(\r\n        function (startTime) {\r\n\r\n            var t = parseInt((Date.parse(new Date()) - startTime) / 1000);\r\n\r\n            $('#hours').html(utils.formatTime(parseInt(t / 3600)));\r\n            $('#minutes').html(utils.formatTime(parseInt(t / 60) % 60));\r\n            $('#seconds').html(utils.formatTime(t % 60));\r\n\r\n        },\r\n        function (startTime) {\r\n\r\n            var t = parseInt((Date.parse(new Date()) - startTime) / 1000);\r\n\r\n            $('#hours').html(utils.formatTime(parseInt(t / 3600)));\r\n            $('#minutes').html(utils.formatTime(parseInt(t / 60) % 60));\r\n            $('#seconds').html(utils.formatTime(t % 60));\r\n\r\n\r\n        },\r\n        function (startTime) {\r\n\r\n            var res = parseInt((Date.parse(new Date()) - startTime) / 60000);\r\n\r\n            // var res = hours * 60 + minutes + parseInt(seconds / 60);\r\n\r\n            if (res < 1 || !window.localStorage.sessionId) {\r\n                return;\r\n            }\r\n\r\n            weui.confirm('是否确定上传记录？', function () {\r\n                uploadRecord(window.localStorage.sessionId, res, null, null);\r\n            }, function () {\r\n                console.log('取消上传记录');\r\n            }, {\r\n                className: 'confirm'\r\n            });\r\n\r\n        },\r\n        function (startTime) {\r\n            $('#hours').html('00');\r\n            $('#minutes').html('00');\r\n            $('#seconds').html('00');\r\n            window.sessionStorage.startTime = startTime;\r\n            \r\n        }\r\n    )\r\n\r\n    if (window.sessionStorage.timerFlag == 'true') {\r\n\r\n        var startTime = parseInt(window.sessionStorage.startTime || Date.parse(new Date()));\r\n\r\n        timerFlag = true;\r\n        $('#btnSwitch').addClass('active');\r\n        myTimer.start(startTime);\r\n\r\n    }\r\n\r\n    $('#btnSwitch').click(function () {\r\n\r\n        if (!timerFlag) {\r\n            $(this).addClass('active');\r\n            timerFlag = true;\r\n            myTimer.start(Date.parse(new Date()));\r\n            window.sessionStorage.startTime = Date.parse(new Date());\r\n        } else {\r\n            $(this).removeClass('active');\r\n            timerFlag = false;\r\n            myTimer.stop();\r\n        }\r\n\r\n        window.sessionStorage.timerFlag = timerFlag;\r\n\r\n    });\r\n\r\n\r\n\r\n    $('#btnRestart').click(function () {\r\n        myTimer.restart();\r\n    });\r\n\r\n});\r\n\r\n// $(document).ready(function () {\r\n\r\n//     var flag = false;\r\n//     var timer = null;\r\n\r\n//     var hours = 0,\r\n//         minutes = 0,\r\n//         seconds = 0,\r\n//         startTime = moment().format('YYYY-MM-DD hh:mm:ss'),\r\n//         endTime = moment().format('YYYY-MM-DD hh:mm:ss');\r\n\r\n\r\n\r\n//     function clearTimer(uploadData) {\r\n\r\n//         uploadData = uploadData ? uploadData : false;\r\n\r\n//         if (timer) {\r\n//             clearInterval(timer);\r\n//             timer = null;\r\n\r\n//             if (uploadData) {\r\n\r\n//                 var res = hours * 60 + minutes + parseInt(seconds / 60);\r\n//                 endTime = moment().format('YYYY-MM-DD hh:mm:ss');\r\n\r\n//                 if (res < 1 || !window.localStorage.sessionId) {\r\n//                     return;\r\n//                 }\r\n\r\n//                 weui.confirm('是否确定上传记录？', function () {\r\n\r\n//                     uploadRecord(window.localStorage.sessionId, res, startTime, endTime);\r\n\r\n//                 }, function () {\r\n//                     console.log('取消');\r\n//                 }, {\r\n//                     className: 'confirm'\r\n//                 });\r\n\r\n//             }\r\n\r\n//         }\r\n\r\n//         hours = 0;\r\n//         minutes = 0;\r\n//         seconds = 0;\r\n\r\n//     }\r\n\r\n//     function startTimer() {\r\n\r\n//         clearTimer();\r\n\r\n//         startTime = moment().format('YYYY-MM-DD hh:mm:ss');\r\n\r\n//         timer = setInterval(function () {\r\n\r\n//             seconds += 1;\r\n\r\n//             if (seconds >= 60) {\r\n//                 seconds = 0;\r\n//                 minutes++;\r\n//             }\r\n\r\n//             if (minutes >= 60) {\r\n//                 minutes = 0;\r\n//                 hours++;\r\n//             }\r\n\r\n//             if (hours >= 24) {\r\n//                 hours = 0;\r\n//             }\r\n\r\n//             $('#hours').html(utils.formatTime(hours));\r\n//             $('#minutes').html(utils.formatTime(minutes));\r\n//             $('#seconds').html(utils.formatTime(seconds));\r\n\r\n//         }, 1000);\r\n//     }\r\n\r\n\r\n//     $('#btnSwitch').click(function () {\r\n\r\n//         if (!flag) {\r\n\r\n//             $(this).addClass('active');\r\n//             flag = true;\r\n\r\n//             startTimer();\r\n\r\n\r\n//         } else {\r\n\r\n//             $(this).removeClass('active');\r\n//             flag = false;\r\n\r\n\r\n//             $('#hours').html('00');\r\n//             $('#minutes').html('00');\r\n//             $('#seconds').html('00');\r\n\r\n//             clearTimer(true);\r\n\r\n//         }\r\n\r\n//     });\r\n\r\n//     $('#btnRestart').click(function () {\r\n//         $('#hours').html('00');\r\n//         $('#minutes').html('00');\r\n//         $('#seconds').html('00');\r\n\r\n//         hours = 0;\r\n//         minutes = 0;\r\n//         seconds = 0;\r\n\r\n//         flag = true;\r\n//         $('#btnSwitch').addClass('active');\r\n//         startTimer();\r\n\r\n//     });\r\n\r\n// });"]}