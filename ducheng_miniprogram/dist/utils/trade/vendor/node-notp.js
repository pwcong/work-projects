"use strict";var crypto=require("./crypto-js.js"),hotp={};hotp.gen=function(t,e){t=t||"",e=e||{};var r=e.counter||0,n=bytesToHex(intToBytes(r)),o=crypto.enc.Hex.parse(n),i=crypto.HmacSHA1(o,t).toString(),s=hexToBytes(i),u=15&s[19],p=(127&s[u])<<24|(255&s[u+1])<<16|(255&s[u+2])<<8|255&s[u+3];return p+="",p.substr(p.length-6,6)},hotp.verify=function(t,e,r){r=r||{};for(var n=r.window||50,o=r.counter||0,i=o-n;i<=o+n;++i)if(r.counter=i,this.gen(e,r)===t)return{delta:i-o};return null};var totp={};totp.gen=function(t,e){e=e||{};var r=e.time||30,n=(new Date).getTime();if(e._t){if("test"!=process.env.NODE_ENV)throw new Error("cannot overwrite time in non-test environment!");n=e._t}return e.counter=Math.floor(n/1e3/r),hotp.gen(t,e)},totp.verify=function(t,e,r){r=r||{};var n=r.time||30,o=(new Date).getTime();if(r._t){if("test"!=process.env.NODE_ENV)throw new Error("cannot overwrite time in non-test environment!");o=r._t}return r.counter=Math.floor(o/1e3/n),hotp.verify(t,e,r)},module.exports.hotp=hotp,module.exports.totp=totp;var intToBytes=function(t){for(var e=[],r=7;r>=0;--r)e[r]=255&t,t>>=8;return e},hexToBytes=function(t){for(var e=[],r=0;r<t.length;r+=2)e.push(parseInt(t.substr(r,2),16));return e},bytesToHex=function(t){for(var e=[],r=0;r<t.length;r++){var n=t[r].toString(16);1===n.length&&(n="0"+n),e.push(n)}return e.join("")};